% Set up list of all days for inclusion
BRAIN_AREA = 'PMd';
% FileName = {'Mihili','07112013',  1  ;...
%             'Mihili','07152013',  1  ;...
%             'Mihili','07192013',  1  ;...
%             'Mihili','08062013',  1  ;...
%             'Mihili','08122013',  1  ;...
%             'Mihili','08152013',  1  ;...
%             'Mihili','07122013',  1  ;...
%             'Mihili','08012013',  1  ;...
%             'Mihili','08222013',  1  ;...
%             'Mihili','09042013',  1  ;...
%             'Mihili','09052013',  1  ;...
%             'Mihili','09062013',  1  ;...
%             'Mihili','09262013',  1  ;...
%             'Mihili','10022013',  1  ;...
%             'Mihili','10072013',  1  ;...
% };   

            
% FileName = {'MrT'   ,'05042013',  1, ;...   
%             'MrT'   ,'05052013',  1, ;...           
%             'MrT'   ,'05062013',  1, ;...         
%             'MrT'   ,'07082013',  1 ...
% };

            
FileName = {'Mihili'   ,'10082015',  1, ;...           
            'Mihili'   ,'10272015',  1, ;...         
            'Mihili'   ,'11022015',  1 ...
};

CO_index = 1;
dir_column = 10;
loop_aligns = {'target','target',12};
loop_ranges = {[50 250],[300 700],[0 200]};

prefs = zeros(size(FileName,1),length(loop_aligns));
neuron_count = zeros(size(FileName,1),1);
alltunedT = cell(size(FileName,1),1);
for daynum = 1:size(FileName,1)
    % Load file
    [alldays, priors, monkey, MO, DA, YE] = load_processed(FileName{daynum,1},FileName{daynum,2},1); 
    pdi = 1;
    speed_script;
    alldays(1).tt(:,12) = alldays(1).tt(:,6) + react_time/1000;
    [best_PDS,preferred_epoch,alltunedT{daynum},fulldat] = tuning_types_PD_func(alldays,BRAIN_AREA,CO_index,dir_column,loop_aligns,loop_ranges);
    
    pref = preferred_epoch; 
    alltuned = alltunedT{daynum};
    save(sprintf('C:\\Users\\limblab\\Desktop\\dropbox_overfill\\PD_LD\\%s_PD90_%s_%s_LD',...
         BRAIN_AREA,FileName{daynum,1},FileName{daynum,2}),'pref','alltuned','fulldat');
     
    prefs(daynum,:) = hist(preferred_epoch,1:length(loop_aligns));
    neuron_count(daynum) = nansum(prefs(daynum,:));

    fprintf('%d/%d\n',daynum,size(FileName,1)); 
end
%%
% figure; hold on; 
% bar(100*tunings./repmat(neuron_count,1,4));

figure; hold on;
bar(100*prefs./repmat(neuron_count,1,3),'stacked');
