%% Files to Load
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%            
BRAIN_AREA = 'PMd';
FileName = {'Mihili','07112013',  2,  [1, 2]    ;...
    
            'Mihili','07152013',  2,  [1, 2]    ;...
            'Mihili','07152013',  3,  [1, 2]    ;...
            
            'Mihili','07192013',  2,  [1, 2]    ;...
            'Mihili','07192013',  3,  [1, 2]    ;...
            'Mihili','07192013',  5,  [1, 2]    ;...
            
            'Mihili','08062013',  2,  [1, 2]    ;...
            'Mihili','08062013',  3,  [1, 2]    ;...
            
            'Mihili','08122013',  2,  [1, 2]    ;...
            'Mihili','08122013',  3,  [1, 2]    ;...
            
            'Mihili','08152013',  2,  [1, 2]    ;...
            
            'Mihili','07122013',  2,  [1, 2]    ;...
    
            'Mihili','08012013',  2,  [1, 2]    ;...
            'Mihili','08012013',  3,  [1, 2]    ;...
            'Mihili','08012013',  4,  [1, 2]    ;...
            
            'Mihili','08222013',  2,  [1, 2]    ;...
            'Mihili','08222013',  3,  [1, 2]    ;...
            
            'Mihili','09042013',  2,  [1, 2]    ;...
            
            'Mihili','09052013',  2,  [1, 2]    ;...
            
            'Mihili','09062013',  2,  [1, 2]    ;...
            
            'Mihili','09262013',  2,  [1, 2]    ;...

            'Mihili','10022013',  2,  [1, 2]    ;...


            'Mihili','10072013',  2,  [1, 2]    ;...

};

% FileName = {'Mihili'   ,'10082015',  2, [1, 2];...           
%             'Mihili'   ,'10272015',  2, [1, 2];...         
%             'Mihili'   ,'11022015',  2, [1, 2] ...
% };


% FileName = {'Mihili','08062013',  2,  [1, 2]    };...
% FileName = {'MrT'   ,'05042013',  2,  [1, 2]    ;...
%             'MrT'   ,'05052013',  2,  [1, 2]    ;...
%             'MrT'   ,'05062013',  2,  [1, 2]    ;...
%             'MrT'   ,'05062013',  2,  [1, 3]    ;...
% %             'MrT'   ,'05062013',  2,  [2, 3]    ;...
%             'MrT'   ,'07082013',  2,  [1, 2]    ...
% };        

session_limit = 10e10;

%% Do activity and Behavior
Act_aligns = {'target','target','target',12};
% Act_wins = {-100:50:250, 300:50:700, -100:50:200};
Act_wins = {[50 250], [300 500], [500 700], [-100 100]};

[FL, FU, FM, RB, BPDS, split_indices,KRATS, PRIS, DDIR, DSTD, DPRC, DVAF,PDSSESS,TVAR, RDS] = ...
    deal(cell(size(FileName,1),1)); %initialize
[PLR,VA,LI,PLRb]=deal(cell(100,1));
counter = 1;
for daynum = 1:size(FileName,1)
   
    fprintf('%d/%d\n',daynum,size(FileName,1)); 
    
    % Load file
    [alldays, priors, monkey, MO, DA, YE] = load_processed(FileName{daynum,1},FileName{daynum,2},0); 
    alldays(1).tt(isnan(alldays(1).tt(:,3)),3) = alldays(1).tt(find(isnan(alldays(1).tt(:,3)))-1,3);
    if isfield(alldays,'bdfM')
        BDF = alldays(1).bdfM;
    elseif isfield(alldays,'kin')
        BDF = alldays(1).kin;
    end
    priors{1}.val = 1; priors{2}.val = 2; priors{3}.val = 3; % % set arbitrary prior values
    
    alldays(2).tt = vertcat(alldays(FileName{daynum,3}).tt); %Concatenate to include all prior blocks
    alldays(2).slices = alldays(2).tt(:,1:5); 
    
    alldays(2).tt(alldays(2).tt(:,3)>100,:) = [];

    llist = flipud(unique(alldays(2).tt(:,3))); 
    alldays(2).tt(~ismember(alldays(2).tt(:,3),llist(FileName{daynum,4})),:) = [];
    llistk = flipud(unique(alldays(2).tt(:,3)));

    load(sprintf('C:\\Users\\limblab\\Desktop\\dropbox_overfill\\PD_V-D-RT\\%s_PD90_%s_%s_V-D-RT.mat',...
         BRAIN_AREA,FileName{daynum,1},FileName{daynum,2}));

    PDS = get_PDS_fulldat(fulldat,pi/2);
    PDmat = [PDS(:,1), PDS(:,2), PDS(:,2), PDS(:,3)];
    
    split_indices{daynum} = 1:session_limit:size(alldays(2).tt,1);
    split_indices{daynum}(end) = size(alldays(2).tt,1);
    if(length(split_indices{daynum})==1); split_indices{daynum} = [1 size(alldays(2).tt,1)]; end
    
    ALLDAYS = alldays;
    for section = 1:(length(split_indices{daynum})-1)
        indis = split_indices{daynum}(section):split_indices{daynum}(section+1);
        alldays(2).tt = ALLDAYS(2).tt(indis,:);
        PDSSESS{counter} = PDS;
        
        for lk = 1:length(llistk)
            lindices = find(alldays(2).tt(:,3)==llistk(lk));
            TVAR{counter}(lk,1) = circ_var(alldays(2).tt(lindices,10));
            RDS{counter}{lk} = alldays(2).tt(lindices,10);
        end
       counter = counter+1; 
    end

%     clearvars -except FL FU FM FileName RB VA BPDS BRAIN_AREA G counter PLR ...
%         split_indices std_priors std_likes std_posts LI PLRb session_limit ...
%         Indall loop_ranges KRATS PRIS dRES_PMd dRES_M1 ISNew REACTTIME DDIR ...
%         DSTD DPRC Act_aligns Act_wins DVAF PDSSESS TVAR;
    
end


